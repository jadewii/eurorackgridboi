<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>JAMNUTZ - Seeds</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/clean-nav.css">
    <script src="assets/clean-nav.js?v=3" defer></script>
    <script src="js/pack-config.js?v=8"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Noto Sans Mono', monospace;
            background: linear-gradient(135deg, #f0f8f0, #e8f5e9);
            color: #000;
        }
        
        .main-content {
            padding: 20px 20px 10px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .shop-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .shop-title {
            font-size: 3rem;
            font-weight: bold;
            letter-spacing: 4px;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }
        
        .currency-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .packs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .pack-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: none !important;
        }
        
        .pack-card.earth {
            border: 3px solid #8D6E63;
        }
        
        .pack-card.space {
            border: 3px solid #2196F3;
            background: linear-gradient(135deg, #fff, #E3F2FD);
        }
        
        .pack-card.galactic {
            border: 3px solid #9C27B0;
            background: linear-gradient(135deg, #fff, #f3e5ff);
        }
        
        
        .pack-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .pack-visual {
            width: 150px;
            height: 200px;
            margin: 0 auto 20px;
            background: transparent;
            border: none !important;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: visible;
        }
        
        .pack-seeds {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            padding: 10px;
        }
        
        .seed-img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            opacity: 0.9;
            filter: brightness(1.2);
        }
        
        /* Removed shine effect - can add different effect here if needed */
        
        .pack-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .pack-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
            min-height: 40px;
        }
        
        .pack-contents {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .pack-contents h4 {
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: #333;
        }
        
        .card-slot {
            display: inline-block;
            width: 40px;
            height: 50px;
            background: #ddd;
            border: 2px solid #999;
            border-radius: 5px;
            margin: 0 5px;
            position: relative;
        }
        
        .card-slot.guaranteed-rare {
            background: linear-gradient(135deg, #FF8A65, #FF6F00);
            border-color: #FF6F00;
        }
        
        .card-slot.guaranteed-legendary {
            background: linear-gradient(135deg, #FFD700, #FFA000);
            border-color: #FFD700;
        }
        
        .pack-price {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 15px;
        }
        
        .buy-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .buy-button:hover {
            background: linear-gradient(135deg, #45a049, #4CAF50);
            transform: scale(1.05);
        }
        
        .buy-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .ev-display {
            font-size: 0.7rem;
            color: #999;
            margin-top: 10px;
        }
        
        .banner-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #FF4444;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 10;
        }
        
        @keyframes pulse {
            0%, 100% { transform: rotate(15deg) scale(1); }
            50% { transform: rotate(15deg) scale(1.1); }
        }
        
        /* Premium seed card styles */
        .pack-card.earth_seed {
            background: linear-gradient(135deg, #fff, #EFEBE9) !important;
            box-shadow: 0 0 20px rgba(141, 110, 99, 0.3);
        }
        
        .pack-card.space_seed {
            background: linear-gradient(135deg, #fff, #E3F2FD) !important;
            box-shadow: 0 0 30px rgba(33, 150, 243, 0.3);
        }
        
        .pack-card.multiverse_seed {
            background: linear-gradient(135deg, #fff, #f3e5ff) !important;
            box-shadow: 0 0 25px rgba(156, 39, 176, 0.3);
        }
        
        /* Special hover for premium items */
        .pack-card.earth_seed:hover,
        .pack-card.space_seed:hover,
        .pack-card.multiverse_seed:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- Navigation injected by clean-nav.js -->
    
    <div class="main-content">
        <div class="shop-header">
            <h1 class="shop-title">SEEDS</h1>
            <div class="currency-display">
                <span id="userNutz">2500</span> NUTZ
            </div>
        </div>
        
        <!-- Multi-Card Packs Section -->
        <div style="margin-bottom: 50px;">
            <div class="packs-grid" id="packsGrid">
                <!-- Packs will be rendered here -->
            </div>
        </div>
    </div>
    
    <script>
        // User's NUTZ (start with $50 worth = 2500 NUTZ for testing)
        let userNutz = 2500;
        
        // Seed data for selection
        const SEED_DATA = {
            earth: {
                name: 'EARTH',
                description: 'Single seed',
                image: 'earth1.png',
                color: '#8D6E63'
            },
            space: {
                name: 'SPACE',
                description: 'Single seed', 
                image: 'space1.png',
                color: '#2196F3'
            },
            multiverse: {
                name: 'MULTIVERSE',
                description: 'Single seed',
                image: 'multi1.png',
                color: '#9C27B0'
            }
        };
        
        // Track selected seed for each pack
        const selectedSeeds = {
            earth: 'earth'  // Default selection
        };
        
        // Track selected pack for PACK section
        const selectedPacks = {
            space: 'earth'  // Default selection
        };
        
        // Function to handle seed selection
        function selectSeed(packId, seedType) {
            selectedSeeds[packId] = seedType;
            
            // Update the main pack visual
            const packCard = document.querySelector(`.pack-card.${packId}`);
            if (packCard) {
                const visualContainer = packCard.querySelector('.pack-visual');
                const packName = packCard.querySelector('.pack-name');
                const packDescription = packCard.querySelector('.pack-description');
                
                if (visualContainer && SEED_DATA[seedType]) {
                    // Replace entire visual content with selected seed
                    const seedId = seedType === 'earth' ? '001' : seedType === 'space' ? '002' : '003';
                    // Adjust sizes: earth smaller at 48%, multiverse smaller at 80%, space normal at 120%
                    let seedSize = '120%';
                    if (seedType === 'earth') seedSize = '48%';
                    else if (seedType === 'multiverse') seedSize = '80%';
                    
                    visualContainer.innerHTML = `
                        <img class="seed-img" data-seed-id="${seedId}" 
                             style="width: ${seedSize}; height: ${seedSize}; object-fit: contain; padding: 0;" 
                             alt="">
                    `;
                    packName.textContent = SEED_DATA[seedType].name;
                    
                    // Update description for the selected seed
                    if (packDescription) {
                        packDescription.textContent = SEED_DATA[seedType].description;
                    }
                    
                    // Reload the seed image
                    loadSingleSeedImage(visualContainer.querySelector('.seed-img'));
                }
                
                // Highlight selected seed
                const seedContainers = packCard.querySelectorAll('.seed-selector');
                seedContainers.forEach(img => {
                    const container = img.parentElement;
                    if (container && img.dataset.seedType === seedType) {
                        container.style.border = '2px solid #4CAF50';
                        container.style.opacity = '1';
                    } else if (container) {
                        container.style.border = '2px solid transparent';
                        container.style.opacity = '0.6';
                    }
                });
            }
        }
        
        // Function to handle pack selection
        function selectPack(packId, packType) {
            selectedPacks[packId] = packType;
            
            // Update the main pack visual
            const packCard = document.querySelector(`.pack-card.${packId}`);
            if (packCard) {
                const visualContainer = packCard.querySelector('.pack-visual');
                
                if (visualContainer) {
                    // Update visual with selected pack (125% size)
                    visualContainer.innerHTML = `
                        <img class="pack-local-img" 
                             data-pack-name="${packType}1"
                             style="width: 125%; height: 125%; object-fit: contain; padding: 0;"
                             alt="">
                    `;
                    
                    // Reload the pack image
                    loadLocalPackImages();
                }
                
                // Highlight selected pack
                const packContainers = packCard.querySelectorAll('.pack-selector');
                packContainers.forEach(img => {
                    const container = img.parentElement;
                    if (container && img.dataset.packType === packType) {
                        container.style.border = '2px solid #4CAF50';
                        container.style.opacity = '1';
                    } else if (container) {
                        container.style.border = '2px solid transparent';
                        container.style.opacity = '0.6';
                    }
                });
            }
        }
        
        // Load a single seed image
        async function loadSingleSeedImage(img) {
            const SEED_WORKER_URL = 'https://eurorack-images.dawlessjammin.workers.dev/api/seed-image';
            const seedId = img.dataset.seedId;
            if (seedId) {
                try {
                    const url = `${SEED_WORKER_URL}?seed_id=seed-${seedId}`;
                    const response = await fetch(url);
                    if (response.ok) {
                        const blob = await response.blob();
                        img.src = URL.createObjectURL(blob);
                    }
                } catch (error) {
                    console.error(`Failed to load seed ${seedId}:`, error);
                }
            }
        }
        
        // Function to get display items for each pack type
        function getPackItemsDisplay(pack) {
            if (pack.type === 'seed') {
                // Premium seeds don't need this display
                return '';
            }
            
            // Different displays for each pack
            if (pack.id === 'earth') {
                // Show 3 seed images from Cloudflare for Earth pack - clickable for selection
                // Using individual sizing to compensate for different aspect ratios
                return `
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <div style="width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; border: 2px solid #4CAF50; border-radius: 5px; cursor: pointer;"
                             onclick="selectSeed('earth', 'earth')">
                            <img class="seed-img seed-selector"
                                 data-seed-id="001"
                                 data-seed-type="earth"
                                 style="width: 50%; height: 50%; object-fit: contain;">
                        </div>
                        <div style="width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; border: 2px solid transparent; border-radius: 5px; cursor: pointer; opacity: 0.6;"
                             onclick="selectSeed('earth', 'space')">
                            <img class="seed-img seed-selector" 
                                 data-seed-id="002"
                                 data-seed-type="space"
                                 style="width: 110%; height: 110%; object-fit: contain;">
                        </div>
                        <div style="width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; border: 2px solid transparent; border-radius: 5px; cursor: pointer; opacity: 0.6;"
                             onclick="selectSeed('earth', 'multiverse')">
                            <img class="seed-img seed-selector"
                                 data-seed-id="003"
                                 data-seed-type="multiverse"
                                 style="width: 90%; height: 90%; object-fit: contain;">
                        </div>
                    </div>
                `;
            } else if (pack.id === 'space') {
                // Show 3 pack images from local Downloads for Space pack - clickable for selection
                return `
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <div style="width: 70px; height: 85px; display: flex; align-items: center; justify-content: center; border: 2px solid #4CAF50; border-radius: 5px; cursor: pointer;"
                             onclick="selectPack('space', 'earth')">
                            <img src="images/earth1.png" 
                                 class="pack-selector"
                                 data-pack-type="earth"
                                 style="width: 90%; height: 90%; object-fit: contain;">
                        </div>
                        <div style="width: 70px; height: 85px; display: flex; align-items: center; justify-content: center; border: 2px solid transparent; border-radius: 5px; cursor: pointer; opacity: 0.6;"
                             onclick="selectPack('space', 'space')">
                            <img src="images/space1.png"
                                 class="pack-selector"
                                 data-pack-type="space"
                                 style="width: 90%; height: 90%; object-fit: contain;">
                        </div>
                        <div style="width: 70px; height: 85px; display: flex; align-items: center; justify-content: center; border: 2px solid transparent; border-radius: 5px; cursor: pointer; opacity: 0.6;"
                             onclick="selectPack('space', 'multi')">
                            <img src="images/multi1.png"
                                 class="pack-selector"
                                 data-pack-type="multi"
                                 style="width: 90%; height: 90%; object-fit: contain;">
                        </div>
                    </div>
                `;
            } else if (pack.id === 'galactic') {
                // Show placeholder boxes for Galactic pack (no images yet)
                return `
                    <div class="card-slot" style="width: 52px; height: 65px;"></div>
                    <div class="card-slot" style="width: 52px; height: 65px;"></div>
                    <div class="card-slot" style="width: 52px; height: 65px;"></div>
                `;
            }
            
            // Fallback to slot display
            let slotsHTML = '';
            pack.slots.forEach(slot => {
                let slotClass = 'card-slot';
                if (slot.type === 'guaranteed') {
                    if (slot.rarity === 'rare+' || slot.rarity === 'rare') {
                        slotClass += ' guaranteed-rare';
                    } else if (slot.rarity === 'legendary-chance') {
                        slotClass += ' guaranteed-legendary';
                    }
                }
                slotsHTML += `<div class="${slotClass}"></div>`;
            });
            return slotsHTML;
        }
        
        function renderPacks() {
            const packsGrid = document.getElementById('packsGrid');
            const seedsGrid = document.getElementById('seedsGrid');
            packsGrid.innerHTML = '';
            if (seedsGrid) seedsGrid.innerHTML = '';
            
            console.log('Available packs:', Object.keys(PACKS));
            
            Object.values(PACKS).forEach(pack => {
                // Skip seed type items since we removed premium seeds section
                if (pack.type === 'seed') return;
                
                const grid = packsGrid;
                const card = document.createElement('div');
                card.className = `pack-card ${pack.id}`;
                
                let badgeHTML = '';
                if (pack.banner) {
                    badgeHTML = '<div class="banner-badge">LIMITED</div>';
                }
                
                // Different visual displays for packs vs seeds
                let visualDisplay = '';
                if (pack.type === 'seed') {
                    // Premium seed display - single HUGE seed image
                    let seedId = '';
                    if (pack.id === 'earth_seed') seedId = 's1';  // Brown/Earth seed
                    if (pack.id === 'space_seed') seedId = 's2';  // Blue/Space seed
                    if (pack.id === 'multiverse_seed') seedId = 's3';  // Multiverse seed
                    
                    visualDisplay = `
                        <img class="seed-img" data-seed-id="${seedId}" 
                             style="width: 100%; height: 100%; object-fit: contain; padding: 10px;" 
                             alt="">
                    `;
                } else {
                    // Different display for each pack type
                    if (pack.id === 'earth') {
                        // Show a seed image for SINGLE (earth seed smaller at 48%)
                        visualDisplay = `
                            <img class="seed-img" data-seed-id="001" 
                                 style="width: 48%; height: 48%; object-fit: contain; padding: 0;" 
                                 alt="">
                        `;
                    } else if (pack.id === 'space') {
                        // Show pack image for PACK (125% size)
                        visualDisplay = `
                            <img class="pack-local-img" 
                                 data-pack-name="space1"
                                 style="width: 125%; height: 125%; object-fit: contain; padding: 0;"
                                 alt="${pack.name}">
                        `;
                    } else if (pack.id === 'galactic') {
                        // Show box image for BOX (125% size)
                        visualDisplay = `
                            <img class="pack-local-img" 
                                 data-pack-name="earthbox"
                                 style="width: 125%; height: 125%; object-fit: contain; padding: 0;"
                                 alt="${pack.name}">
                        `;
                    } else {
                        // Fallback for packs without images
                        visualDisplay = `
                            <div style="color: white; font-size: 3rem;">📦</div>
                        `;
                    }
                }
                
                // Add special badges for premium items
                if (pack.limited) {
                    badgeHTML += '<div class="banner-badge" style="background: #FF1744;">LIMITED</div>';
                }
                // Remove inline style that might conflict
                // Premium styling is handled by CSS classes
                
                // For SINGLE (earth pack), show the selected seed's name and description
                const displayName = pack.id === 'earth' && selectedSeeds[pack.id] ? 
                    SEED_DATA[selectedSeeds[pack.id]].name : 
                    pack.name;
                const displayDescription = pack.id === 'earth' && selectedSeeds[pack.id] ? 
                    SEED_DATA[selectedSeeds[pack.id]].description : 
                    pack.description;
                
                card.innerHTML = `
                    ${badgeHTML}
                    <div class="pack-visual" style="border: none;">
                        ${visualDisplay}
                    </div>
                    <div class="pack-name">${displayName}</div>
                    <div class="pack-description">${displayDescription}</div>
                    
                    ${pack.type !== 'seed' ? `
                    <div class="pack-contents">
                        <h4>SELECT:</h4>
                        <div>${getPackItemsDisplay(pack)}</div>
                    </div>
                    ` : ''}
                    
                    <div class="pack-price">${pack.price} NUTZ</div>
                    
                    <button class="buy-button" onclick="buyPack('${pack.id}')" 
                            ${userNutz < pack.price ? 'disabled' : ''}
                            style="${pack.premium ? 'background: linear-gradient(135deg, #9C27B0, #7B1FA2);' : ''}">
                        ${userNutz < pack.price ? 'NOT ENOUGH NUTZ' : pack.type === 'seed' ? 'BUY SEED' : 'BUY PACK'}
                    </button>
                    
                    <div class="ev-display">Expected Value: ~${Math.floor(pack.ev)} NUTZ</div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        function buyPack(packId) {
            const pack = PACKS[packId];
            
            if (userNutz >= pack.price) {
                userNutz -= pack.price;
                document.getElementById('userNutz').textContent = userNutz;
                
                // Store selected seed type if applicable
                if (packId === 'earth' && selectedSeeds[packId]) {
                    localStorage.setItem('selectedSeed', selectedSeeds[packId]);
                }
                
                // Redirect to pack opening page
                localStorage.setItem('openingPack', packId);
                localStorage.setItem('userNutz', userNutz);
                window.location.href = 'pack-opening.html';
            } else {
                alert(`Not enough NUTZ! You need ${pack.price} NUTZ but only have ${userNutz} NUTZ.`);
            }
        }
        
        // Load seed images from worker
        async function loadSeedImages() {
            const SEED_WORKER_URL = 'https://eurorack-images.dawlessjammin.workers.dev/api/seed-image';
            const seedImages = document.querySelectorAll('.seed-img');
            
            console.log('Loading seed images, found:', seedImages.length);
            
            for (const img of seedImages) {
                const seedId = img.dataset.seedId;
                if (seedId) {
                    try {
                        // Use the new format: seed-001.webp, seed-002.webp, etc.
                        const url = `${SEED_WORKER_URL}?seed_id=seed-${seedId}`;
                        console.log('Loading seed from:', url);
                        const response = await fetch(url);
                        if (response.ok) {
                            const blob = await response.blob();
                            img.src = URL.createObjectURL(blob);
                            console.log(`Loaded seed ${seedId} successfully`);
                        } else {
                            console.error(`Failed to load seed ${seedId}: ${response.status} ${response.statusText}`);
                        }
                    } catch (error) {
                        console.error(`Failed to load seed ${seedId}:`, error);
                    }
                }
            }
        }
        
        // Load pack wrapper images
        async function loadPackImages() {
            const SEED_WORKER_URL = 'https://eurorack-images.dawlessjammin.workers.dev/api/seed-image';
            const packImages = document.querySelectorAll('.pack-img');
            
            console.log('Loading pack images, found:', packImages.length);
            
            for (const img of packImages) {
                const packId = img.dataset.packId;
                if (packId) {
                    try {
                        // Pack images are stored as pack-earth, pack-space, pack-multi
                        // Convert to seed API format
                        const seedId = packId.replace('pack-', 'p');
                        const mapping = {
                            'pearth': 's4',
                            'pspace': 's5', 
                            'pmulti': 's6'
                        };
                        const url = `${SEED_WORKER_URL}?seed_id=${mapping[seedId] || 's1'}`;
                        
                        // Actually, let's fetch the pack images directly
                        const actualUrl = `https://eurorack-images.dawlessjammin.workers.dev/api/seed-image?seed_id=${packId}`;
                        const response = await fetch(actualUrl);
                        if (response.ok) {
                            const blob = await response.blob();
                            img.src = URL.createObjectURL(blob);
                            console.log(`Loaded pack image ${packId} successfully`);
                        }
                    } catch (error) {
                        console.error(`Failed to load pack ${packId}:`, error);
                    }
                }
            }
        }
        
        // Load local pack images
        function loadLocalPackImages() {
            const packImages = document.querySelectorAll('.pack-local-img');
            console.log('Loading local pack images, found:', packImages.length);
            
            packImages.forEach(img => {
                const packName = img.dataset.packName;
                if (packName) {
                    // Try to load from local images folder
                    img.src = `images/${packName}.png`;
                    img.onerror = function() {
                        // If local image fails, show fallback
                        console.log(`Could not load local image for ${packName}`);
                        this.style.display = 'none';
                        this.parentElement.innerHTML = '<div style="color: #666; font-size: 2rem;">📦</div>';
                    };
                }
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved NUTZ
            const savedNutz = localStorage.getItem('userNutz');
            if (savedNutz) {
                userNutz = parseInt(savedNutz);
                document.getElementById('userNutz').textContent = userNutz;
            }
            
            renderPacks();
            // Load all images after rendering
            setTimeout(() => {
                loadSeedImages();  // Load seed images from Cloudflare for Earth pack
                loadLocalPackImages();  // Load pack wrapper images from local
            }, 100);
        });
    </script>
</body>
</html>