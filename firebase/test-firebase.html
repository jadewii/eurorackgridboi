<!DOCTYPE html>
<html>
<head>
    <title>Firebase Connection Test</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #f5f5f5;
            padding: 40px;
            max-width: 600px;
            margin: 0 auto;
        }
        .status {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 18px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }
        .pending {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }
        button {
            background: #000;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #333;
        }
    </style>
</head>
<body>
    <h1>üî• Firebase Connection Test</h1>
    
    <div id="status" class="status pending">
        Connecting to Firebase...
    </div>
    
    <div id="details"></div>
    
    <div id="actions" style="display: none;">
        <h2>Test Actions:</h2>
        <button onclick="testSignUp()">Create Test User</button>
        <button onclick="testDatabase()">Test Database Write</button>
    </div>

    <script type="module">
        // Import Firebase config
        import './firebase-config.js';
        
        // Import Firebase SDK
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getAuth, 
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { 
            getFirestore,
            collection,
            addDoc,
            getDocs
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const statusDiv = document.getElementById('status');
        const detailsDiv = document.getElementById('details');
        const actionsDiv = document.getElementById('actions');
        
        try {
            // Initialize Firebase
            const app = initializeApp(window.firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            
            // Make functions global for button clicks
            window.testAuth = auth;
            window.testDb = db;
            
            statusDiv.className = 'status success';
            statusDiv.innerHTML = '‚úÖ Firebase Connected Successfully!';
            
            detailsDiv.innerHTML = `
                <h3>Configuration Details:</h3>
                <ul>
                    <li>Project ID: ${window.firebaseConfig.projectId}</li>
                    <li>Auth Domain: ${window.firebaseConfig.authDomain}</li>
                    <li>App ID: ${window.firebaseConfig.appId}</li>
                </ul>
                <h3>Services Available:</h3>
                <ul>
                    <li>‚úÖ Authentication</li>
                    <li>‚úÖ Firestore Database</li>
                </ul>
            `;
            
            actionsDiv.style.display = 'block';
            
            // Test sign up function
            window.testSignUp = async () => {
                const email = `test${Date.now()}@example.com`;
                const password = 'testpass123';
                
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    alert(`‚úÖ Test user created!\nEmail: ${email}\nUID: ${userCredential.user.uid}`);
                } catch (error) {
                    alert('Error creating user: ' + error.message);
                }
            };
            
            // Test database function
            window.testDatabase = async () => {
                try {
                    const docRef = await addDoc(collection(db, 'test'), {
                        message: 'Hello from EurorackGrid!',
                        timestamp: new Date().toISOString(),
                        test: true
                    });
                    alert(`‚úÖ Database write successful!\nDocument ID: ${docRef.id}`);
                } catch (error) {
                    alert('Error writing to database: ' + error.message);
                }
            };
            
        } catch (error) {
            statusDiv.className = 'status error';
            statusDiv.innerHTML = '‚ùå Firebase Connection Failed';
            detailsDiv.innerHTML = `<p>Error: ${error.message}</p>`;
        }
    </script>
</body>
</html>