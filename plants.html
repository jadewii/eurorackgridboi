<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>JAMNUTZ - Plants</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/clean-nav.css">
    <script src="assets/clean-nav.js?v=3" defer></script>
    <script defer>
        // Direct worker image loading
        const WORKER_URL = 'https://eurorack-images.dawlessjammin.workers.dev/api/plant-image';
        
        async function loadPlantImage(imgElement, plantId) {
            try {
                const response = await fetch(`${WORKER_URL}?plant_id=${plantId}`);
                if (response.ok) {
                    const blob = await response.blob();
                    imgElement.src = URL.createObjectURL(blob);
                    imgElement.classList.remove('loading');
                    imgElement.classList.add('loaded');
                }
            } catch (error) {
                console.error(`Failed to load ${plantId}:`, error);
                imgElement.classList.add('error');
            }
        }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Noto Sans Mono', monospace;
            background: #f0f8f0;
            color: #000;
        }
        
        .main-content {
            padding: 40px 40px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Collection Header */
        .collection-header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .collection-title {
            font-size: 2rem;
            font-weight: bold;
            letter-spacing: 3px;
            margin-top: 0;
            margin-bottom: 8px;
            color: #2e7d32;
            text-transform: uppercase;
        }
        
        .collection-progress {
            max-width: 600px;
            margin: 0 auto 10px;
        }
        
        .progress-text {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border: 2px solid #2e7d32;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
        }
        
        /* Category Tabs - Compact Style */
        .category-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .category-tab {
            padding: 10px 20px;
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.85rem;
            color: #4CAF50;
            transition: all 0.2s;
        }
        
        .category-tab:hover {
            background: #4CAF50;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76,175,80,0.2);
        }
        
        .category-tab.active {
            background: #4CAF50;
            color: white;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            margin-bottom: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            margin-top: 2px;
        }
        
        /* Collection Grid */
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            padding: 20px;
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            min-height: 450px;
        }
        
        .item-slot {
            aspect-ratio: 1;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            padding: 10px;
        }
        
        .item-slot.owned {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #f1f8e9, #ffffff);
        }
        
        .item-slot.owned:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(76,175,80,0.3);
        }
        
        .item-slot.locked {
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
            border: 2px solid #999;
            color: #666;
            position: relative;
            overflow: hidden;
        }
        
        /* Mystery state - show ? */
        .item-slot.mystery {
            background: linear-gradient(135deg, #e0e0e0, #f5f5f5);
            border: 2px solid #999;
        }
        
        .item-slot.mystery::before {
            content: '?';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            font-weight: bold;
            color: #999;
            z-index: 10;
        }
        
        /* Silhouette state - black silhouette */
        .item-slot.silhouette {
            background: linear-gradient(135deg, #f5f5f5, #fff);
            border: 2px solid #666;
        }
        
        .item-slot.silhouette .plant-image {
            filter: brightness(0) saturate(100%);
            opacity: 1;
        }
        
        /* Ensure images are properly styled */
        .plant-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 5px;
            position: relative;
            z-index: 1;
        }
        
        .item-slot.locked:hover {
            background: linear-gradient(135deg, #fff, #f0f0f0);
            border-color: #4CAF50;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 15px rgba(76,175,80,0.4);
            cursor: pointer;
        }
        
        
        .item-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #FFD700;
            color: #000;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.6rem;
            font-weight: bold;
        }
        
        /* View Controls */
        .view-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 5px;
        }
        
        .view-options {
            display: flex;
            gap: 10px;
        }
        
        .view-btn {
            padding: 6px 12px;
            background: white;
            border: 2px solid #4CAF50;
            color: #4CAF50;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 5px;
            font-size: 0.8rem;
        }
        
        .view-btn:hover {
            background: #4CAF50;
            color: white;
        }
        
        .search-box {
            padding: 8px 15px;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            font-family: inherit;
            width: 200px;
        }
        
        /* Pulse animation for urgency elements */
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Shimmer effect for locked items */
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        .item-slot.locked::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255,255,255,0.3),
                transparent
            );
            background-size: 1000px 100%;
            animation: shimmer 3s infinite;
            pointer-events: none;
        }
        
        /* Enhanced item slot styles */
        .item-slot.urgent {
            border-color: #FF4444;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
            animation: pulse 3s infinite;
        }
        
        .item-slot.daily-special {
            border-color: #FF9800;
            background: linear-gradient(135deg, #FFF8E1, #ffffff);
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.4);
        }
        
        /* Achievement notification animation */
        @keyframes slideIn {
            0% { 
                transform: translateX(400px); 
                opacity: 0; 
            }
            100% { 
                transform: translateX(0); 
                opacity: 1; 
            }
        }
        
        /* Image loading states */
        .plant-image {
            transition: opacity 0.3s ease;
        }
        
        .plant-image.loading {
            opacity: 0.5;
            background: #f0f0f0;
        }
        
        .plant-image.loaded {
            opacity: 1;
        }
        
        .plant-image.error {
            opacity: 0.3;
            background: #ffeeee;
        }
    </style>
</head>
<body>
    <!-- Navigation is injected by clean-nav.js -->
    
    <div class="main-content">
        <!-- Collection Header -->
        <div class="collection-header">
            <h1 class="collection-title">PLANTS</h1>
            <div class="collection-progress">
                <div class="progress-text">COLLECTED: <span id="itemCount">0</span> / 20 <span style="color: #FFD700; font-weight: bold; margin-left: 10px;">NEXT REWARD: 10 PLANTS</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%">
                        <span id="progressPercent">0%</span>
                    </div>
                </div>
            </div>
        </div>
        
        
        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value">0</div>
                <div class="stat-label">Owned</div>
            </div>
            <div class="stat">
                <div class="stat-value">20</div>
                <div class="stat-label">Missing</div>
            </div>
            <div class="stat">
                <div class="stat-value">3</div>
                <div class="stat-label">Rare</div>
            </div>
            <div class="stat">
                <div class="stat-value">4</div>
                <div class="stat-label">Legendary</div>
            </div>
            <div class="stat">
                <div class="stat-value">2</div>
                <div class="stat-label">Limited</div>
            </div>
        </div>
        
        <!-- Achievement Notification (Hidden by default) -->
        <div id="achievementNotification" style="display: none; position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #FFD700, #FFA000); color: #000; padding: 20px; border-radius: 15px; border: 3px solid #FF6F00; box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3); z-index: 1000; animation: slideIn 0.5s ease-out;">
            <div style="font-size: 1.1rem; font-weight: bold; margin-bottom: 5px;">🏆 ACHIEVEMENT UNLOCKED!</div>
            <div id="achievementText" style="font-size: 0.9rem; margin-bottom: 10px;">Plant Enthusiast - Collect 5 Plants</div>
            <div style="font-size: 0.8rem; opacity: 0.8;">+50 JAMCOINS earned!</div>
            <button onclick="closeAchievement()" style="position: absolute; top: 5px; right: 10px; background: none; border: none; font-size: 1.2rem; cursor: pointer;">×</button>
        </div>
        
        <!-- View Controls -->
        <div class="view-controls">
            <div class="view-options">
                <button class="view-btn" onclick="filterItems('all')">ALL</button>
                <button class="view-btn" onclick="filterItems('owned')">OWNED</button>
                <button class="view-btn" onclick="filterItems('missing')">MISSING</button>
            </div>
            <input type="text" class="search-box" placeholder="Search items...">
        </div>
        
        
        
        <!-- Collection Grid -->
        <div class="collection-grid" id="collectionGrid">
            <!-- Sample items - will be populated dynamically -->
        </div>
    </div>
    
    <script>
        // Plant collection data with psychological game elements
        // Plant discovery states: mystery, silhouette, owned
        const plantItems = [
            { id: 'p1', name: 'Plant #1', owned: false, discovered: false },
            { id: 'p2', name: 'Plant #2', owned: false, discovered: false },
            { id: 'p3', name: 'Plant #3', owned: false, discovered: false },
            { id: 'p4', name: 'Plant #4', owned: false, discovered: false },
            { id: 'p5', name: 'Plant #5', owned: false, discovered: false },
            { id: 'p6', name: 'Plant #6', owned: false, discovered: false },
            { id: 'p7', name: 'Plant #7', owned: false, discovered: false },
            { id: 'p8', name: 'Plant #8', owned: false, discovered: false },
            { id: 'p9', name: 'Plant #9', owned: false, discovered: false },
            { id: 'p10', name: 'Plant #10', owned: false, discovered: false },
            { id: 'p11', name: 'Plant #11', owned: false, discovered: false },
            { id: 'p12', name: 'Plant #12', owned: false, discovered: false, rarity: 'rare' },
            { id: 'p13', name: 'Plant #13', owned: false, discovered: false },
            { id: 'p14', name: 'Plant #14', owned: false, discovered: false },
            { id: 'p15', name: 'Plant #15', owned: false, discovered: false, rarity: 'rare' },
            { id: 'p16', name: 'Plant #16', owned: false, discovered: false, rarity: 'legendary' },
            { id: 'p17', name: 'Plant #17', owned: false, discovered: false, rarity: 'rare' },
            { id: 'p18', name: 'Plant #18', owned: false, discovered: false, rarity: 'legendary' },
            { id: 'p19', name: 'Plant #19', owned: false, discovered: false, rarity: 'legendary' },
            { id: 'p20', name: 'Plant #20', owned: false, discovered: false, rarity: 'rare' }
        ];
        
        let currentFilter = 'all';
        
        // Check localStorage for owned plants
        function getOwnedPlants() {
            return JSON.parse(localStorage.getItem('ownedPlants') || '[]');
        }
        
        function updateOwnership() {
            const owned = getOwnedPlants();
            const discovered = JSON.parse(localStorage.getItem('discoveredPlants') || '[]');
            
            plantItems.forEach(item => {
                item.owned = owned.includes(item.id);
                // If owned, also mark as discovered
                if (item.owned) {
                    item.discovered = true;
                } else {
                    item.discovered = discovered.includes(item.id);
                }
            });
            
            // Update stats
            const ownedCount = plantItems.filter(p => p.owned).length;
            document.getElementById('itemCount').textContent = ownedCount;
            document.getElementById('progressPercent').textContent = Math.floor((ownedCount / 20) * 100) + '%';
            document.getElementById('progressFill').style.width = (ownedCount / 20 * 100) + '%';
            
            // Update stats bar
            document.querySelector('.stats-bar .stat:nth-child(1) .stat-value').textContent = ownedCount;
            document.querySelector('.stats-bar .stat:nth-child(2) .stat-value').textContent = 20 - ownedCount;
        }
        
        function filterItems(filter) {
            currentFilter = filter;
            renderGrid();
        }
        
        async function renderGrid() {
            const grid = document.getElementById('collectionGrid');
            grid.innerHTML = '';
            
            const imagesToLoad = [];
            
            plantItems.forEach(item => {
                if (currentFilter === 'owned' && !item.owned) return;
                if (currentFilter === 'missing' && item.owned) return;
                
                const slot = document.createElement('div');
                slot.className = 'item-slot';
                
                // Add special classes for psychological elements
                if (!item.owned) {
                    if (item.limited && item.limited < 10) {
                        slot.classList.add('urgent');
                    }
                    if (item.daily) {
                        slot.classList.add('daily-special');
                    }
                }
                
                // Determine display state
                let displayState = 'mystery';
                if (item.owned) {
                    displayState = 'owned';
                } else if (item.discovered) {
                    displayState = 'silhouette';
                }
                
                slot.className = `item-slot ${displayState}`;
                
                if (displayState === 'owned') {
                    // Full color for owned plants
                    let badges = '';
                    if (item.rarity) badges += `<div class="item-badge" style="background: ${item.rarity === 'legendary' ? '#FFD700' : '#FF8A65'};">${item.rarity.toUpperCase()}</div>`;
                    
                    slot.innerHTML = `
                        <img class="plant-image" data-plant-id="${item.id}">
                        ${badges}
                    `;
                    
                    const imgElement = slot.querySelector('.plant-image');
                    imagesToLoad.push({
                        element: imgElement,
                        plantId: item.id,
                        isOwned: true
                    });
                    
                } else if (displayState === 'silhouette') {
                    // Black silhouette for discovered but not owned
                    let badges = '';
                    if (item.rarity) badges += `<div class="item-badge" style="background: ${item.rarity === 'legendary' ? '#FFD700' : '#FF8A65'};">${item.rarity.toUpperCase()}</div>`;
                    
                    slot.innerHTML = `
                        <img class="plant-image" data-plant-id="${item.id}">
                        <div style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); 
                                background: rgba(0,0,0,0.7); color: white; padding: 3px 8px; 
                                border-radius: 5px; font-weight: bold; font-size: 0.7rem; z-index: 2;">DISCOVERED</div>
                        ${badges}
                    `;
                    
                    const imgElement = slot.querySelector('.plant-image');
                    imagesToLoad.push({
                        element: imgElement,
                        plantId: item.id,
                        isOwned: false
                    });
                    
                } else {
                    // Mystery box for undiscovered - NO IMAGE AT ALL
                    let badges = '';
                    if (item.rarity) badges += `<div class="item-badge" style="background: #999;">???</div>`;
                    
                    slot.innerHTML = `
                        ${badges}
                    `;
                    // No image loading for mystery state!
                }
                
                slot.onclick = () => {
                    if (!item.owned) {
                        // Redirect to pack shop
                        window.location.href = 'plant-pack-shop.html';
                    }
                };
                
                grid.appendChild(slot);
            });
            
            // Load all images using worker
            for (const item of imagesToLoad) {
                loadPlantImage(item.element, item.plantId);
            }
        }
        
        // Toggle garden shelf visibility
        function toggleGarden() {
            const shelf = document.getElementById('gardenShelf');
            shelf.style.display = shelf.style.display === 'none' ? 'block' : 'none';
        }
        
        // Setup shelf drop zone
        function setupShelf() {
            const shelfArea = document.getElementById('shelfArea');
            
            shelfArea.ondragover = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
                shelfArea.style.background = 'rgba(76, 175, 80, 0.1)';
            };
            
            shelfArea.ondragleave = () => {
                shelfArea.style.background = 'white';
            };
            
            shelfArea.ondrop = (e) => {
                e.preventDefault();
                shelfArea.style.background = 'white';
                
                const plantId = e.dataTransfer.getData('plantId');
                const plantName = e.dataTransfer.getData('plantName');
                
                // Remove instruction text if present
                const instructionText = shelfArea.querySelector('p');
                if (instructionText) {
                    instructionText.remove();
                }
                
                // Create plant display on shelf
                const plantDisplay = document.createElement('div');
                plantDisplay.style.cssText = 'width: 100px; height: 100px; background: linear-gradient(135deg, #f1f8e9, #ffffff); border: 2px solid #4CAF50; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: move;';
                plantDisplay.innerHTML = `
                    <div style="font-size: 1.5rem; font-weight: bold; color: #4CAF50;">P</div>
                    <div style="font-size: 0.7rem; color: #333; margin-top: 5px;">${plantName}</div>
                `;
                
                // Allow removing from shelf
                plantDisplay.ondblclick = () => {
                    plantDisplay.remove();
                    if (shelfArea.children.length === 0) {
                        shelfArea.innerHTML = '<p style="color: #999; width: 100%; text-align: center;">Drag your plants here to arrange your garden</p>';
                    }
                };
                
                shelfArea.appendChild(plantDisplay);
            };
        }
        
        // Achievement System
        function showAchievement(title = "Plant Enthusiast", description = "Collect 5 Plants", reward = 50) {
            const notification = document.getElementById('achievementNotification');
            const text = document.getElementById('achievementText');
            
            text.textContent = `${title} - ${description}`;
            notification.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                closeAchievement();
            }, 5000);
        }
        
        function closeAchievement() {
            const notification = document.getElementById('achievementNotification');
            notification.style.display = 'none';
        }
        
        // Trigger achievement based on collection milestones
        function checkAchievements() {
            const ownedCount = plantItems.filter(item => item.owned).length;
            const rareCount = plantItems.filter(item => item.owned && item.rarity === 'rare').length;
            const legendaryCount = plantItems.filter(item => item.owned && item.rarity === 'legendary').length;
            
            // Achievement triggers (this would normally be stored in user progress)
            if (ownedCount === 5) {
                showAchievement("Plant Enthusiast", "Collect 5 Plants", 50);
            } else if (ownedCount === 10) {
                showAchievement("Green Thumb", "Collect 10 Plants", 100);
            } else if (rareCount >= 1) {
                showAchievement("Rare Collector", "Own your first Rare plant", 75);
            } else if (legendaryCount >= 1) {
                showAchievement("Legend Hunter", "Own your first Legendary plant", 200);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateOwnership(); // Check what's owned
            renderGrid();
            setupShelf();
        });
    </script>
</body>
</html>